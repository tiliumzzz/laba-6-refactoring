# Лабораторная работа: Рефакторинг order_processing.py

## Цель работы
Отрефакторить код обработки заказов, улучшив его читаемость и поддерживаемость, не изменив поведение.

## Исходный код
Исходный код содержал одну большую функцию `process_checkout()` длиной 80+ строк, которая выполняла все операции: парсинг запроса, валидацию, расчёты и форматирование.

## Обнаруженные проблемы качества

### 1. Нарушение принципа единственной ответственности (SRP)
Функция `process_checkout()` делала слишком много:
- Парсила входные данные
- Валидировала их
- Выполняла бизнес-расчёты (скидки, налоги)
- Форматировала результат

### 2. "Магические числа" в коде
В коде были "зашиты" числовые константы:
- `0.21` — ставка налога
- `0.10`, `0.20`, `0.05` — проценты скидок
- `50`, `10` — фиксированные скидки
- `100`, `200` — пороговые значения

### 3. Высокая цикломатическая сложность
Множество вложенных условий и циклов в одной функции.

### 4. Проблемы с тестируемостью
Невозможно было протестировать отдельные части логики (например, только расчёт скидки).

## Применённые рефакторинги

### 1. Вынесение констант
Все "магические числа" вынесены в именованные константы в начале файла:
```python
DEFAULT_CURRENCY = "USD"
TAX_RATE = 0.21
COUPON_SAVE10_RATE = 0.10
COUPON_SAVE20_RATE_HIGH = 0.20
COUPON_SAVE20_RATE_LOW = 0.05
COUPON_VIP_HIGH = 50
COUPON_VIP_LOW = 10
VIP_THRESHOLD = 100
SAVE20_THRESHOLD = 200
```
### 2. Разделения на функции с четкими ответственностями 
- validate_request() -- только валидация входных данных
- calculate_subtotal() -- только подсчет суммы товаров
- calculate_discount() -- только логика скидок
- genearte_order_id() -- только генерация ID заказа
### 3. Улучшение читаемости
- Добавлены docstring к каждой функции
- Замена type(items) is not list на isinstance(items,list)
- Улучшение имен переменных(it->items)
### 4. Упрощение логики
- Использование max(0,value) вместо проверки и присваивания
- Линеный поток в основной функции


## Результат рефакторинга
### Что улучшилось:
- Читаемость — код теперь читается как сценарий сверху вниз
- Тестируемость — каждую функцию можно тестировать отдельно
- Поддерживаемость — для изменения скидки нужно править только calculate_discount()
- Переиспользуемость — функции можно использовать в других частях системы

### Статистика изменений:
- Исходный размер process_checkout(): 80+ строк
- Новый размер process_checkout(): 25 строк (уменьшение на 69%)
- Общее количество функций: 6 (было 2)
- "Магические числа": 0 (все вынесены в константы)

## Вывод
  Рефакторинг позволил превратить монолитную функцию в модульную систему с чёткими ответственностями. Код стал более читаемым, поддерживаемым и подготовленным к будущим изменениям. При этом функциональность полностью сохранена, что подтверждается прохождением всех тестов.
